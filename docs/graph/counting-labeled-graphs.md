给定一个含有 $n$ 个顶点的无向简单图。要计算带有 $n$ 个顶点的带标号图的数量 $G_n$ （带标号即顶点被标记为从 1 到 n 的数字）。

因为图是无向简单图，对于每个边 $(i,j)$ ，假定 $i < j$ 。这样所有边构成的集合有基数 $\dbinom{n}{2}$ ，即 $\dfrac{n(n-1)}{2}$ 。

由于任何标号图均由其边唯一确定，因此具有 n 个顶点的标记图的数量等于：

$$
G_n = 2^{\dfrac{n(n-1)}{2}}
$$

## 无向连通图

我们用 $C_n$ 表示 $n$ 顶点连通图的数量。

首先我们讨论存在多少非连通图。然后用 $G_n$ 减去非连通图数就可以得到连通图数。另外我们会计算连通根图的数量。根图就是我们通过将一个顶点标记为根顶点的一类图。显然，对于一个 $n$ 点标号图，可以产生 $n$ 种根图。因此我们在最后将结果除以 $n$ ，这样获得的结果就是非连通图的数目。

根顶点会出现在大小为 $1,\cdots,n-1$ 的连通块中。有 $k \dbinom{n}{k} C_k G_{n-k}$ 种方式使得根顶点位于具有 $k$ 个顶点的连通块中。（有 $\dbinom{n}{k}$ 中方式选择 $k$ 个分支，它们以 $C_k$ 种方式被连通到一起。 $k$ 个顶点中任意一个都可以是根顶点，而剩下的 $n-k$ 个顶点可以以任何方式连通或者断开，从而了 $G_{n-k}$ 的一个因子。）

综上， $n$ 点非连通图的个数是：

$$
\dfrac{1}{n} \sum_{k=1}^{n-1} k  \dbinom{n}{k} C_k G_{n-k}
$$

而连通图的个数是：

$$
C_n = G_n - \dfrac{1}{n} \sum_{k=1}^{n-1} k \dbinom{n}{k} C_k G_{n-k}
$$

## 含 $k$ 个连通块的无向连通图

本节我们将在上一节的基础上学习如何计算具有 $n$ 个顶点和 $k$ 个连通块的无向连通图的数量。

考虑 DP。对于每个 $i\le n$ 和 $j\le k$ ，计算 $D[i][j]$ ——具有 $i$ 个顶点和 $j$ 个分量的标号图的数量。

如果我们已经知道 $D[i][j]$ ，取最后一个顶点（标号为 $n$ ，这个点属于某个分支），就可以计算 $D[n][k]$ 。。如果这个分支的大小为 $s$ ，那么就有 $\dbinom{n-1}{s-1}$ 中方法选择构成此分支的点集，并且有 $C_s$ 种方法连通它们。这样我们就得到如下的递归关系：

$$
D[n][k] = \sum_{s=1}^{n} \dbinom{n-1}{s-1} C_s D[n-s][k-1]
$$

 **本页面部分内容译自博文 [Подсчет помеченных графиков](https://github.com/e-maxx-eng/e-maxx-eng/blob/358bdfb972df51644e6365e25e36e2e7dcacc633/src/combinatorics/counting_labeled_graphs.md) 与其英文翻译版 [Counting labeled graphs](https://cp-algorithms.com/combinatorics/counting_labeled_graphs.html) 。其中俄文版版权协议为 Public Domain + Leave a Link；英文版版权协议为 CC-BY-SA 4.0。** 
